<!DOCTYPE html>
{% load static %}
{% load custom_filters %}
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Dashboard - IQVIA Manila Hub</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="{% static "img/iqvia-icon.png" %}" rel="icon">
  <link href="{% static "img/iqvia-icon.png" %}" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  
 <!-- Vendor CSS Files -->
 <link href="{% static "vendor/bootstrap/css/bootstrap.min.css" %}" rel="stylesheet">
 <link href="{% static "vendor/bootstrap-icons/bootstrap-icons.css" %}" rel="stylesheet">
 <link href="{% static "vendor/boxicons/css/boxicons.min.css" %}" rel="stylesheet">
 <link href="{% static "vendor/quill/quill.snow.css" %}" rel="stylesheet">
 <link href="{% static "vendor/quill/quill.bubble.css" %}" rel="stylesheet">
 <link href="{% static "vendor/remixicon/remixicon.css" %}" rel="stylesheet">
 <link href="{% static "vendor/simple-datatables/style.css" %}" rel="stylesheet">
 <!-- <link href="https://cdn.jsdelivr.net/npm/flag-icon-css@3.5.0/css/flag-icon.min.css" rel="stylesheet"> -->
 <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet"> -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 
  <!-- Template Main CSS File -->
  <link href="{% static "css/style.css" %}" rel="stylesheet">
  <link href="{% static "vendor/css/style.css" %}" rel="stylesheet">
  

  <style>
   


    .styled-table {
    border-collapse: collapse;
    margin: 25px 0;
    font-size: 12px;
    font-family: sans-serif;
    min-width: 400px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
    }
    .styled-table thead tr {
        background-color: #00A3E0;
        color: #ffffff;
        text-align: left;
    }
    .styled-table th,
    .styled-table td {
        padding: 12px 15px;
    }

    .styled-table tbody tr {
        border-bottom: 1px solid #dddddd;
    }

    .styled-table tbody tr:nth-of-type(even) {
        background-color: #f3f3f3;
    }

    .styled-table tbody tr:last-of-type {
        border-bottom: 2px solid #00A3E0;
    }

    .styled-table-2 tbody tr:last-of-type {
        border-bottom: 2px solid #2eca6a;
    }

    
    /* .styled-table tbody tr.active-row {
        font-weight: bold;
        color: #00A3E0;
        background-color: #f0f0f0;
    } */

    .styled-table tbody tr.active-row td {
    font-weight: bold;
    color: #43b02a;
    background-color: #f0f0f0;
}

    .tableBody_award tbody tr:last-of-type {
      border-bottom: 2px solid #9e9e9e81;
  }

  .highlighted-row {
    /* background-color: #2eca6a27;  */
    color: #00A3E0;
    font-weight: bold;
  }

  .scrollable-dropdown {
  max-height: 300px; /* Adjust the maximum height as needed */
  overflow-y: auto;
}




  </style>

</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="{% url 'first_app:index' %}" class="logo d-flex align-items-center">
        <img src="{% static "img/iqvia-icon.png" %}" alt="" width="47" height="25">
        <span class="d-none d-lg-block" style="font-size: 25px;">MPH Dashboard</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->

    <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div><!-- End Search Bar -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item d-block d-lg-none">
          <a class="nav-link nav-icon search-bar-toggle " href="#">
            <i class="bi bi-search"></i>
          </a>
        </li><!-- End Search Icon-->

        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
            <img src="{% static "img/profile.jpeg" %}" alt="Profile" class="rounded-circle">
            <span class="d-none d-md-block dropdown-toggle ps-2">Jericho</span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
            <li class="dropdown-header">
              <h6>Jericho Barquez</h6>
              <span>RPS Team</span>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                <i class="bi bi-person"></i>
                <span>My Profile</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                <i class="bi bi-gear"></i>
                <span>Account Settings</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="pages-faq.html">
                <i class="bi bi-question-circle"></i>
                <span>Need Help?</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="#">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sign Out</span>
              </a>
            </li>

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

      <ul class="sidebar-nav" id="sidebar-nav">

          <li class="nav-item">
              <a class="nav-link collapsed" href="{% url 'first_app:index' %}">
                  <i class="bi bi-pin-map-fill"></i>
                  <span>Manila Production Hub</span>
              </a>
          </li><!-- End Dashboard Nav -->
          <li class="nav-item">
              <a class="nav-link collapsed" href="{% url 'first_app:performance' %}">
                  <i class="bi bi-grid"></i>
                  <span>Performance</span>
              </a>
          </li><!-- End Dashboard Nav -->
          <li class="nav-item">
              <a class="nav-link collapsed" data-bs-target="#productivy-nav" data-bs-toggle="collapse" href="#">
                  <i class="bi bi-graph-up"></i><span>Productivity</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="productivy-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'first_app:productivity' region='top_management' %}">
                          <i class="bi bi-circle"></i><span>TM REVIEW</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:productivity' region='apac' %}">
                          <i class="bi bi-circle"></i><span>APAC</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:productivity' region='emea' %}">
                          <i class="bi bi-circle"></i><span>EMEA</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:productivity' region='usca' %}">
                          <i class="bi bi-circle"></i><span>USCA</span>
                      </a>
                  </li>

              </ul>
          </li><!-- End Tables Nav -->
          <!--<li class="nav-item">
              <a class="nav-link collapsed" data-bs-target="#quality-nav" data-bs-toggle="collapse" href="#">
                  <i class="bi bi-bar-chart-line"></i><span>C&B Quality</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="quality-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'first_app:quality' region='apac' %}">
                          <i class="bi bi-circle"></i><span>APAC</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:quality' region='emea' %}">
                          <i class="bi bi-circle"></i><span>EMEA</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:quality' region='usca' %}">
                          <i class="bi bi-circle"></i><span>USCA</span>
                      </a>
                  </li>

              </ul>
          </li>--><!-- End Tables Nav -->
          <li class="nav-item">
              <a class="nav-link collapsed" data-bs-target="#quality-report-nav" data-bs-toggle="collapse" href="#">
                  <i class="bi bi-bar-chart-line"></i><span>Quality</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="quality-report-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'first_app:quality_report' region='apac' %}">
                          <i class="bi bi-circle"></i><span>APAC</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:quality_report' region='emea' %}">
                          <i class="bi bi-circle"></i><span>EMEA</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:quality_report' region='usca' %}">
                          <i class="bi bi-circle"></i><span>USCA</span>
                      </a>
                  </li>

              </ul>
          </li><!-- End Tables Nav -->
          <li class="nav-item">
              <a class="nav-link " data-bs-target="#delivery-nav" data-bs-toggle="collapse" href="#">
                  <i class="bi bi-truck"></i><span>Service Delivery</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="delivery-nav" class="nav-content collapse show" data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'first_app:service_delivery' region='apac' %}" class="active">
                          <i class="bi bi-circle"></i><span>APAC</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:service_delivery' region='emea' %}">
                          <i class="bi bi-circle"></i><span>EMEA</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:service_delivery' region='usca' %}">
                          <i class="bi bi-circle"></i><span>USCA</span>
                      </a>
                  </li>

              </ul>
          </li><!-- End Tables Nav -->

          <!--<li class="nav-item">
              <a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
                  <i class="bi bi-gear"></i><span>Utilization</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="components-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'first_app:utilization' region='apac' %}">
                          <i class="bi bi-circle"></i><span>APAC</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:utilization' region='emea' %}">
                          <i class="bi bi-circle"></i><span>EMEA</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:utilization' region='usca' %}">
                          <i class="bi bi-circle"></i><span>USCA</span>
                      </a>
                  </li>
              </ul>
          </li>-->
    <!-- End Forms Nav -->

          <li class="nav-item">
              <a class="nav-link collapsed" data-bs-target="#charts-nav" data-bs-toggle="collapse" href="#">
                  <i class="bi bi-gear"></i><span>Rax Utilization</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="charts-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'first_app:rax_utilization' region='apac' %}">
                          <i class="bi bi-circle"></i><span>APAC</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:rax_utilization' region='emea' %}">
                          <i class="bi bi-circle"></i><span>EMEA</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:rax_utilization' region='usca' %}">
                          <i class="bi bi-circle"></i><span>USCA</span>
                      </a>
                  </li>
              </ul>
          </li><!-- End Forms Nav -->

          <li class="nav-item">
              <a class="nav-link collapsed" data-bs-target="#attrition-nav" data-bs-toggle="collapse" href="#">
                  <i class="bi bi-graph-down"></i><span>Attrition</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="attrition-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'first_app:attrition' region='apac' %}">
                          <i class="bi bi-circle"></i><span>APAC</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:attrition' region='emea' %}">
                          <i class="bi bi-circle"></i><span>EMEA</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:attrition' region='usca' %}">
                          <i class="bi bi-circle"></i><span>USCA</span>
                      </a>
                  </li>

              </ul>
          </li><!-- End Tables Nav -->

          <li class="nav-item">
              <a class="nav-link collapsed" data-bs-target="#tables-nav" data-bs-toggle="collapse" href="#">
                  <i class="bi bi-layout-text-window-reverse"></i><span>Headcount</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="tables-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'first_app:headcount' region='apac' %}">
                          <i class="bi bi-circle"></i><span>APAC</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:headcount' region='emea' %}">
                          <i class="bi bi-circle"></i><span>EMEA</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:headcount' region='usca' %}">
                          <i class="bi bi-circle"></i><span>USCA</span>
                      </a>
                  </li>

              </ul>
          </li><!-- End Tables Nav -->
          <li class="nav-item">
              <a class="nav-link collapsed" data-bs-target="#forms-nav" data-bs-toggle="collapse" href="#">
                  <i class="bi bi-person-check"></i><span>Attendance</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="forms-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">

                  <li>
                      <a href="{% url 'first_app:attendance' region='apac' %}">
                          <i class="bi bi-circle"></i><span>APAC</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:attendance' region='emea' %}">
                          <i class="bi bi-circle"></i><span>EMEA</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'first_app:attendance' region='usca' %}">
                          <i class="bi bi-circle"></i><span>USCA</span>
                      </a>
                  </li>

              </ul>
          </li><!-- End Forms Nav -->

          <li class="nav-item">
              <a class="nav-link collapsed" href="users-profile.html">
                  <i class="bi bi-person"></i>
                  <span>Profile</span>
              </a>
          </li><!-- End Profile Page Nav -->



          <li class="nav-item">
              <a class="nav-link collapsed" href="{% url 'first_app:pages_contact' %}">
                  <i class="bi bi-envelope"></i>
                  <span>Contact</span>
              </a>
          </li><!-- End Contact Page Nav -->


          <li class="nav-item">
              <a class="nav-link collapsed" href="{% url 'admin:index' %}" target="_blank">
                  <i class="bi bi-gear"></i>
                  <span>Administrator</span>
              </a>
          </li><!-- End Login Page Nav -->




      </ul>

  </aside><!-- End Sidebar-->

  <main id="main" class="main">

    <div class="pagetitle">
      <h1>APAC</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'first_app:index' %}"><i class="bi bi-house-door"></i></a></li>
          <li class="breadcrumb-item">Service Delivery</li>
          <li class="breadcrumb-item active">Metrics</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section dashboard">
      <div class="row">

        <!-- Left side columns -->
        <!-- <div class="col-lg-8">
          <div class="row"> -->

            <!-- Sales Card -->
            <div class="col-xxl-3 col-md-6">
              <div class="card info-card sales-card">

                <div class="card-body sales-card-body">
                  <h5 class="card-title">Service Delivery<span> | Year To Date</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-cart"></i>
                    </div>
                    <div class="ps-3">
                      <h6>{{overall_percentages}}%</h6>
                      <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->
                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End Sales Card -->

            <!-- Revenue Card -->
            <div class="col-xxl-3 col-md-6">
              <div class="card info-card sales-card">

                <div class="card-body sales-card-body">
                  <h5 class="card-title">Service Delivery<span> | {{formatted_latest_processing_period}}</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-cart"></i>
                    </div>
                    <div class="ps-3">
                      <h6>{{latest_month_percentage}}%</h6>
                      
                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End Revenue Card -->

            <!-- Customers Card -->
            <!-- <div class="col-xxl-3 col-xl-12">

              <div class="card info-card sales-card">
                <div class="card-body sales-card-body">
                  <h5 class="card-title">Delivery<span> | Year To Date</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-gear"></i>
                    </div>
                    <div class="ps-3">
                      <h6>{{overall_percentage_data.overall_percentage_coding}}</h6>
                      

                    </div>
                  </div>

                </div>
              </div>

            </div> -->

            <!-- Customers Card -->
            <!-- <div class="col-xxl-3 col-xl-12">

              <div class="card info-card sales-card">
                <div class="card-body sales-card-body">
                  <h5 class="card-title">Delivery<span> | Year To Date</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-gear"></i>
                    </div>
                    <div class="ps-3">
                      


                    </div>
                  </div>

                </div>
              </div>

            </div> -->

             <!-- Reports -->
             <!-- <div class="col-12">
              <div class="card">

                <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow" id="countryDropdown">
                      <li class="dropdown-header text-start">
                          <h6>Filter</h6>
                      </li>
                      {% for country in quality_records.keys %}
                        <li><a class="dropdown-item" href="#" data-country="{{ country }}">{{ country|title }}</a></li>
                      {% endfor %}
                  </ul>
              </div>

                <div class="card-body">
                  <h5 class="card-title">Quality Rate<span> | Year to Date</span></h5>

                  <div id="quality_rate_chart" style="min-height: 420px;" class="echart"></div>

                  <script>
                    document.addEventListener("DOMContentLoaded", () => {
                        var quality_rate_chart = echarts.init(document.querySelector('#quality_rate_chart'));
                
                        function updateChart(countryName, metricsData) {
                            quality_rate_chart.clear();
                            // Set options for the bar chart
                            var metrics = Object.keys(metricsData);
                            var metrics = Object.keys(metricsData).filter(metric => metric !== 'total' && metric !== 'name');
                
                            var seriesData = metrics.map(metric => {
                                return {
                                    name: metric,
                                    type: 'bar',
                                    stack: 'total',
                                    label: {
                                        show: true
                                    },
                                    emphasis: {
                                        focus: 'series'
                                    },
                                    itemStyle: {
                                        // Adjust color as needed
                                        // color: getRandomColor() 
                                    },
                                    data: Object.keys(metricsData[metric]).map(month => {
                                        return {
                                            name: month,
                                            value: metricsData[metric][month] ? metricsData[metric][month] : 0
                                        };
                                    })
                                };
                            });
                
                            var options = {
                                title: {
                                    text: countryName,
                                    left: 'center'
                                },
                                tooltip: {
                                    trigger: 'axis',
                                    axisPointer: {
                                        type: 'shadow'
                                    }
                                },
                                toolbox: {
                                    show: true,
                                    feature: {
                                        mark: { show: true },
                                        dataView: { show: true, readOnly: false },
                                        // restore: { show: true },
                                        saveAsImage: { show: true }
                                    }
                                },
                                legend: {
                                    data: metrics,
                                    bottom: 0
                                },
                                grid: {
                                    left: '3%',
                                    right: '4%',
                                    bottom: '15%',
                                    containLabel: true
                                },
                                xAxis: {
                                    type: 'category',
                                    data: Object.keys(metricsData[metrics[0]]).filter(month => month !== 'total' && month !== 'name')
                                },
                                yAxis: {
                                    type: 'value'
                                },
                                series: seriesData
                            };
                
                            quality_rate_chart.setOption(options);
                        }
                
                        // Assuming you have the initial data available in your template context
                        var initialCountryName = Object.keys({{ quality_records_without_total|safe }})[0];
                        var initialMetricsData = Object.values({{ quality_records_without_total|safe }})[0];
                
                        // Initial chart rendering
                        updateChart(initialCountryName, initialMetricsData);
                
                        // Dropdown change event
                        $('#countryDropdown .dropdown-item').click(function() {
                            var selectedCountry = $(this).data('country');
                            console.log(selectedCountry)
                
                            // Make an AJAX request to your Django view
                            $.ajax({
                               type: 'GET',
                                url: '/mph/quality_per_country_click/',
                                data: {
                                    'country': selectedCountry,
                                    'region': 'apac'
                                },
                                // dataType: 'json',
                                success: function(data) {
                                    var countryName = Object.keys(data.quality_records_without_total)[0];
                                    var metricsData = Object.values(data.quality_records_without_total)[0];
                
                                    // Update the chart with new data
                                    updateChart(countryName, metricsData);
                                },
                                error: function(error) {
                                    // Handle errors
                                    console.error('Error loading data for ' + selectedCountry, error);
                                }
                            });
                        });
                    });
                </script>

                </div>

              </div>
            </div>End Reports -->


             <div class="col-lg-9">
              <div class="card">

                <!-- <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow" id="countryDropdownPercentage" style="max-height: 400px; overflow-y: auto;">
                    <li class="dropdown-header text-start">
                      <h6>Filter</h6>
                    </li>

                    {% for country in unique_countries %}
                        <li><a class="dropdown-item" href="#" data-country="{{ country }}">{{ country|title }}</a></li>
                    {% endfor %}

                    
                  </ul>
                </div> -->

                <div class="card-body">
                  <h5 class="card-title">Service Delivery/ Country <span> | Year to Date</span></h5>

                  <!-- Line Chart -->
                  <div id="serviceDeliveryChart" style="min-height: 520px;" class="echart"></div>
                  <script>
                  document.addEventListener('DOMContentLoaded', function () {
                    var service_delivery_percentage = {{ service_delivery_data|safe }};
                    var processingPeriods = [...new Set(service_delivery_percentage.map(entry => entry.processing_period))];
                    var countries = [...new Set(service_delivery_percentage.map(entry => entry.country))];
                    var colors = ['#072F5F', '#1261A0', '#3895D3', '#80B2D3', '#A0D1EC', '#BAE0F3', '#EDF2FB'];
                    var average_percentage_per_month = {{ average_percentage_per_month|safe }};
                    
                    var serviceDeliveryChart = echarts.init(document.getElementById('serviceDeliveryChart'));
                
                    var option = {
                        toolbox: {
                            show: true,
                            feature: {
                                dataView: { readOnly: false },
                                // magicType: { type: ['bar', 'line'] },
                                // restore: { show: true },
                                saveAsImage: {},
                            },
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: { type: 'shadow' },
                            // formatter: function (params) {
                            //     return params[0].name + '<br/>' + params.map(param => param.marker + param.seriesName + ': ' + (param.value * 100).toFixed(2) + '%').join('<br/>');
                            // },
                        },
                        legend: {
                            data: countries,
                            top: '5%',
                        },
                        grid: {
                            top: '20%',
                            left: '3%',
                            right: '4%',
                            bottom: '5%',
                            containLabel: true,
                        },
                        xAxis: {
                            type: 'category',
                            data: processingPeriods,
                            // axisLabel: {
                            //     formatter: '{value}%'
                            // }
                        },
                        yAxis: {
                            type: 'value',
                            axisLabel: {
                                formatter: '{value}%',
                            },
                        },
                        series: countries.map((country, index) => {
                            return {
                                name: country,
                                type: 'bar',
                                barGap: '0%',    
                                data: service_delivery_percentage
                                    .filter(entry => entry.country === country)
                                    .map(entry => entry.percentage),
                                label: {
                                    show: true,
                                    position: 'inside',
                                    rotate: 90, // Change the rotation angle as per your preference
                                    formatter: '{c}%',
                                },
                                itemStyle: {
                                    color: colors[index % colors.length],
                                },
                            };
                        }).concat([{
                            name: 'Overall Percentage',
                            type: 'line',
                            symbol: 'circle',
                            smooth: true,
                            symbolSize: 12,
                            // yAxisIndex: 1,
                            data: processingPeriods.map(period => average_percentage_per_month[period] || null),
                            label: {
                                show: true,
                                position: 'top',
                                formatter: function (params) {
                                    return params.value !== null ? params.value.toFixed(2) + '%' : 'N/A';
                                },
                            },
                            itemStyle: {
                                color: '#43B02A',
                            },
                            lineStyle: {
                              // width: 3,
                              shadowColor: 'rgba(0,0,0,0.3)',
                              shadowBlur: 6,
                              shadowOffsetY: 8
                            },
                            emphasis: {
                                // focus: 'series', // Apply emphasis to the whole series
                                itemStyle: {
                                    borderColor: 'orange',
                                    borderWidth: 2,
                                },
                            },
                        }]),
                    };
                
                    serviceDeliveryChart.setOption(option);
                });
              </script>
                
                  <!-- End Line Chart -->

                </div>

              </div>
            </div><!-- End Reports -->

            <div class="col-lg-3">
              <div class="card">

              
                <div class="card-body">
                  <h5 class="card-title">Service Delivery <span> | Year to Date</span></h5>

                  <!-- Line Chart -->
                  <div id="overallServiceDelivery" style="min-height: 520px;" class="echart"></div>
                  <script>
                    document.addEventListener('DOMContentLoaded', function () {
                        // Get the overall_percentage_dict data from Django
                        var overall_percentage_dict = {{ overall_percentage_dict|safe }};
                        console.log(overall_percentage_dict)
                
                        // Extract countries and values from the Django data
                        const countries = Object.keys(overall_percentage_dict);
                        const values = Object.values(overall_percentage_dict).map(value => parseFloat(value.toFixed(2)));

                        console.log(countries)
                        console.log(values)
                
                        // Initialize ECharts
                        const chart = echarts.init(document.getElementById('overallServiceDelivery'));
                
                        // Set up the options for the bar chart
                        const options = {
                          toolbox: {
                              show: true,
                              feature: {
                                dataView: { readOnly: false },
                                // restore: { show: true },
                                saveAsImage: {}
                              }
                            },
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                  type: 'shadow' // Display the tooltip shadow as a box
                                }
                              },
                              grid: {
                                top: '15%',
                                left: '1%',
                                right: '5%',
                                bottom: '7%',
                                containLabel: true
                              },
                              xAxis: {
                              type: 'value',
                              max: 100,
                              axisLabel: {
                                formatter: '{value}%',
                              },
                              interval: 25
                            },
                            yAxis: {
                                type: 'category',
                                data: countries,
                            },
                            series: [
                                {
                                    type: 'bar',
                                    barWidth: '60%',
                                    data: values,
                                    label: {
                                        show: true,
                                        position: 'insideRight',
                                        formatter: '{c}%',
                                    },
                                    itemStyle: {
                                        color: '#0c7bc0',
                                        barBorderRadius: [0, 20, 20, 0] 
                                    },
                                    emphasis: { 
                                        itemStyle: {
                                            color: '#00A3E0',
                                            barBorderRadius: [0, 20, 20, 0], 
                                        }
                                    }
                                }
                            ]
                        };
                
                        chart.setOption(options);
                    });
                </script>
                

                </div>

              </div>
            </div><!-- End Reports -->


        <div class="col-lg-6">

          <div class="card">
            <div class="filter">
              <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
              <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                <li class="dropdown-header text-start">
                  <h6>Filter</h6>
                </li>

                {% for country in list_of_unique_countries %}
                <li><a class="dropdown-item country-link" href="#" data-country="{{ country }}">{{ country }}</a></li>
                {% endfor %}
              </ul>
            </div>

            <div class="card-body">
              <h5 class="card-title">Reasons of Delay <span>| Year To Date</span></h5>
              
              <table class="table  table-hover table-sm styled-table">
                <thead>
                    <tr>
                        <th id="countryHeading" scope="col" style="background-color: #00A3E0; color: #ffffff;">Overall</th>
                        <th scope="col" style="background-color: #00A3E0; color: #ffffff;">Count</th>
                    </tr>
                </thead>
                <tbody>
                  {% for item in late_reason_count %}
                      <tr>
                          <td>{{ item.late_delivery_reason }}</td>
                          <td>{{ item.reason_count }}</td>
                      </tr>
                  {% endfor %}
                  <tr style="font-weight: bold; background-color: rgba(0,163,224,0.04);">
                      <th style="font-weight: bold; background-color: rgba(0,163,224,0.02);">Grand Total</th>
                      <th style="font-weight: bold; background-color: rgba(0,163,224,0.02);">{{ grand_total_delayed }}</th>
                  </tr>
              </tbody>
            </table>
            </div>

          </div>

          <script>
            $(document).ready(function() {
                // Attach a click event handler to the country links
                $('.country-link').on('click', function(event) {
                    event.preventDefault();
            
                    // Get the selected country from the data attribute
                    var selectedCountry = $(this).data('country');
                    console.log(selectedCountry)
            
                    // Make the AJAX call using the selectedCountry
                    $.ajax({
                        type: 'GET',
                        url: '/mph/service_late_reason_per_country/',  // Replace with your actual AJAX endpoint
                        data: {
                          'country': selectedCountry,
                          'region': 'apac'
                      },
                        success: function(data) {
                            // Handle the AJAX response
                            console.log(data);
                            updateTable(data, selectedCountry);
                        },
                        error: function(error) {
                            console.error('Error:', error);
                        }
                    });
                });

                // Function to update the table with new data
                function updateTable(data, selectedCountry) {
                    // Assuming 'late_reason_count' is available in the data
                    var lateReasonCount = data;
                    var grandTotalDelayed = data.grand_total_delayed;

                    
                    // Update the table heading to display the selected country
                    $('#countryHeading').text(selectedCountry);

                    // Update the table body
                    var tbody = $('.styled-table tbody');
                    tbody.empty();  // Clear existing rows

                    if (lateReasonCount.service_late_reason_country.length > 0) {
                        for (var i = 0; i < lateReasonCount.service_late_reason_country.length; i++) {
                            var item = lateReasonCount.service_late_reason_country[i];
                            var row = '<tr><td>' + item.late_delivery_reason + '</td><td>' + item.reason_count + '</td></tr>';
                            tbody.append(row);
                        }
                        // Update the grand total row
                        var grandTotalRow = '<tr style="font-weight: bold; background-color: rgba(0,163,224,0.04);"><th style="font-weight: bold; background-color: rgba(0,163,224,0.02);">Grand Total</th><th style="font-weight: bold; background-color: rgba(0,163,224,0.02);">' + grandTotalDelayed + '</th></tr>';
                        tbody.append(grandTotalRow);
                    } else {
                        // If no delays for this country, display a message
                        var noDelayMessage = '<tr><td colspan="2">No delay for this country</td></tr>';
                        tbody.append(noDelayMessage);
                    }

                    
                }
            });
            </script>

        </div>

        <div class="col-lg-6">
          <div class="card">
            <div class="filter">
              <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
              <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                <li class="dropdown-header text-start">
                  <h6>Filter</h6>
                </li>

                {% for country in list_of_unique_countries %}
                <li><a class="dropdown-item country-link-pie" href="#" data-country="{{ country }}">{{ country }}</a></li>
                {% endfor %}
              </ul>
            </div>

            <div class="card-body">
              <h5 class="card-title">Reasons of Delay Rate <span>| Year to Date</span></h5>
              
              <!-- Line Chart -->
              <div id="reasonsOfDelayChart" style="min-height: 400px;" class="echart"></div>
              <div id="noDelayMessage" style="display: none; text-align: center; font-size: 12px; color: #555;">
                No delay for this country
            </div>

              <script>
                  document.addEventListener('DOMContentLoaded', function () {
                      var reasonsOfDelayChart = echarts.init(document.getElementById('reasonsOfDelayChart'));

                      // Initial data for the pie chart
                      var initialLateReasonCount = {{ late_reason_count|safe }};

                      // Function to update the pie chart
                      function updatePieChart(selectedCountry) {
                          $.ajax({
                              type: 'GET',
                              url: '/mph/service_late_reason_per_country/', 
                              data: { 'country': selectedCountry,
                                      'region': 'apac'
                              },
                              success: function (data) {
                                  var lateReasonCount = data.service_late_reason_country;
                                  if (lateReasonCount.length === 0) {

                                    $('#noDelayMessage').show();
                                    reasonsOfDelayChart.setOption({
                                      title: {
                                              text: selectedCountry,
                                              left: 'center',
                                              top: 60,
                                              textStyle: {
                                                  fontSize: 12,
                                                  fontWeight: 'bold'
                                              }
                                          },
                                      legend: {
                                          data: []
                                      },
                                      series: [
                                          {
                                              data: []
                                          }
                                      ]
                                  });
                                  } else {
                                    $('#noDelayMessage').hide();
                                      reasonsOfDelayChart.setOption({
                                        title: {
                                              text: selectedCountry,
                                              left: 'center',
                                              top: 60,
                                              textStyle: {
                                                  fontSize: 12,
                                                  fontWeight: 'bold'
                                              }
                                          },
                                          graphic: [],  // Clear any previous graphic elements
                                          legend: {

                                              data: lateReasonCount.map(item => item.late_delivery_reason)
                                          },
                                          series: [
                                              {
                                                  data: lateReasonCount.map(item => ({ name: item.late_delivery_reason, value: item.reason_count }))
                                              }
                                          ]
                                      });
                                  }
                              },
                              error: function (error) {
                                  console.error('Error:', error);
                              }
                          });
                      }

                      // Set the initial chart options and render the chart
                      var option = {
                          color: ['#072F5F', '#1261A0', '#3895D3', '#80B2D3', '#A0D1EC', '#BAE0F3', '#EDF2FB'],
                          toolbox: {
                              show: true,
                              feature: {
                                  dataView: { readOnly: false },
                                  restore: { show: true },
                                  saveAsImage: {}
                              }
                          },
                          tooltip: {
                              trigger: 'item',
                              formatter: '{a} <br/>{b}: {c} ({d}%)'
                          },
                          legend: {
                              top: 'top',
                              left: 'left',
                              data: initialLateReasonCount.map(item => item.late_delivery_reason)
                          },
                          title: {
                                text: 'Overall',
                                left: 'center',
                                top: 60,
                                textStyle: {
                                    fontSize: 12,
                                    fontWeight: 'bold'
                                }
                            },
                          series: [
                              {
                                  name: 'Reasons of Delay',
                                  type: 'pie',
                                  radius: '65%',
                                  center: ['50%', '60%'],
                                  avoidLabelOverlap: false,
                                  label: {
                                      show: true,
                                      position: 'outside',
                                      formatter: '{b}\n{d}%'
                                  },
                                  
                                  emphasis: {
                                      label: {
                                          show: true,
                                          fontSize: '15',
                                          fontWeight: 'bold'
                                      }
                                  },
                                  data: initialLateReasonCount.map(item => ({ name: item.late_delivery_reason, value: item.reason_count }))
                              }
                          ]
                      };

                      reasonsOfDelayChart.setOption(option);

                      // Event listener for country links
                      $('.country-link-pie').on('click', function (event) {
                          event.preventDefault();
                          var selectedCountryPie = $(this).data('country');
                          updatePieChart(selectedCountryPie);
                      });
                  });
              </script>
              <!-- End Line Chart -->

            </div>

          </div>
        </div>



        <!-- Right side columns -->
        
      </div>
    </section>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>IQVIA</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
    
      Designed by <a href="#">IQVIA Manila Hub</a>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

 <!-- Vendor JS Files -->
 <!-- <script src="{% static "vendor/simple-datatables/simple-datatables.js" %}"></script> -->
 <!-- <script src="{% static "vendor/apexcharts/apexcharts.min.js" %}"></script> -->
 <script src="{% static "vendor/bootstrap/js/bootstrap.bundle.min.js" %}"></script>
 <!-- <script src="{% static "vendor/chart.js/chart.umd.js" %}"></script> -->
 <script src="{% static "vendor/echarts/echarts.min.js" %}"></script>
 <script src="{% static "vendor/quill/quill.min.js" %}"></script>
 
 <script src="{% static "vendor/tinymce/tinymce.min.js" %}"></script>
 <script src="{% static "vendor/php-email-form/validate.js" %}"></script>
 <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script> -->
 <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script> -->


 <!-- Template Main JS File -->
 <script src="{% static "js/main.js" %}"></script>


</body>

</html>